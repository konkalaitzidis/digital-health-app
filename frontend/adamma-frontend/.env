import Constants from "expo-constants";

# // 1) read from env (Expo automatically exposes EXPO_PUBLIC_* at runtime)
const ENV_BASE = process.env.EXPO_PUBLIC_API_URL || "";

# // 2) current default (kept)
const DEFAULT_BACKEND_BASE = "http://192.168.1.154:8000";

# // 3) small sanitizer to avoid /ping or /predict in base
function normalizeBase(u) {
  let base = (u || "").trim();
  if (base && !/^https?:\/\//.test(base)) base = `http://${base}`;
  base = base.replace(/\/+$/, "").replace(/\/(ping|predict)$/, "");
  return base;
}

# // 4) on mount, load order: AsyncStorage -> .env -> hardcoded default
useEffect(() => {
  (async () => {
    try {
      const saved = await AsyncStorage.getItem(STORAGE_KEY);
      if (saved) {
        setBackendBase(normalizeBase(saved));
      } else if (ENV_BASE) {
        setBackendBase(normalizeBase(ENV_BASE));
      } else {
        setBackendBase(DEFAULT_BACKEND_BASE);
      }
    } catch {
      setBackendBase(DEFAULT_BACKEND_BASE);
    }
  })();
}, []);
